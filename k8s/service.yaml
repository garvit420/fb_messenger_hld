# =============================================================================
# Kubernetes Service for FB Messenger Backend
# =============================================================================
# This manifest defines HOW to access the application:
# - Service type (ClusterIP, NodePort, LoadBalancer)
# - Port mappings
# - Pod selection
#
# Services provide:
# 1. Stable network endpoint (pods are ephemeral, services are stable)
# 2. Load balancing across multiple pods
# 3. Service discovery within the cluster
# =============================================================================

apiVersion: v1
kind: Service
metadata:
  name: fb-messenger-backend
  labels:
    app: fb-messenger-backend
spec:
  # ---------------------------------------------------------------------------
  # SERVICE TYPE: How the service is exposed
  # ---------------------------------------------------------------------------
  # ClusterIP: Internal cluster access only (default)
  # NodePort: Accessible on each node's IP at a static port
  # LoadBalancer: Provisions external load balancer (cloud providers)
  #
  # WHY ClusterIP: For internal microservices communication
  # In production, you'd typically put an Ingress or LoadBalancer in front
  # ---------------------------------------------------------------------------
  type: ClusterIP

  # ---------------------------------------------------------------------------
  # SELECTOR: Which pods receive traffic from this service
  # WHY: Matches the labels defined in the Deployment template
  # ---------------------------------------------------------------------------
  selector:
    app: fb-messenger-backend

  # ---------------------------------------------------------------------------
  # PORTS: Port configuration for the service
  # ---------------------------------------------------------------------------
  ports:
    - name: http
      protocol: TCP
      port: 80           # Port exposed by the service (what clients connect to)
      targetPort: 8000   # Port on the pod/container (where app listens)
      # For NodePort type, you could add: nodePort: 30080

---
# =============================================================================
# Optional: NodePort Service for external access during testing
# =============================================================================
# Uncomment this if you need to access the service from outside the cluster
# without setting up an Ingress controller

# apiVersion: v1
# kind: Service
# metadata:
#   name: fb-messenger-backend-nodeport
#   labels:
#     app: fb-messenger-backend
# spec:
#   type: NodePort
#   selector:
#     app: fb-messenger-backend
#   ports:
#     - name: http
#       protocol: TCP
#       port: 80
#       targetPort: 8000
#       nodePort: 30080  # Access via <NodeIP>:30080
